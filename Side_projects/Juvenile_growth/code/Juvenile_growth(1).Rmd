---
title: "Juvenile Growth"
author: 
date: "6/20/2024"
output: html_document

description: 
---
Last updated 06/20/24 by K. Lenderman
  - Created script
  - Note: Check Kennedy's path


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
#knitr::opts_knit$set(root.dir = 'C:/Users/kennedy.mcgrath/Documents/Github/EAD-ASEB_EPA_LISS_Disease_Surveillance') #Kennedy's
#knitr::opts_knit$set(root.dir = 'C:/Users/mariah.kachmar/Documents/Github/EAD-ASEB_EPA_LISS_Disease_Surveillance') #Mariah's
knitr::opts_knit$set(root.dir = 'C:/Users/kyra.lenderman/Documents/Github/EAD-ASEB_EPA_LISS_Disease_Surveillance') #Kyra's
#knitr::opts_knit$set(root.dir = 'C:/Users/kelly.roper/Documents/Github/EAD-ASEB_EPA_LISS_Disease_Surveillance') #Kelly's
#knitr::opts_knit$set(root.dir = 'C:/Users/katherine.mcfarland/Documents/Github/EAD-ASEB_EPA_LISS_Disease_Surveillance') #Katie's
```


```{r,echo = FALSE}
library("ggplot2")
library("readxl")
library("plyr")                                     
library("dplyr")
library("Rmisc")
library("readr")  
library("lubridate")
library("purrr")
library("tidyr")
```

### This code chunk merges all .csv files within the Tissue processing folder into one data fram and outputs the full dataset into a .csv master file. This allows us to download the raw data as a .csv, add it to the repository folder, and create the master data file without copying and pasting data in excel.
# reading in .csv files from local folder
```{r}
#Collecting and merging all raw data
data_all <- list.files(path = "Side_projects/Juvenile_growth/raw_data",  #need to have file with data in "raw_data"\
                       pattern = "*.csv", full.names = TRUE)%>% lapply(read_csv) %>% bind_rows()
data_all

as.data.frame(data_all)  # Convert tibble to data.frame

#data_all <- data_all %>% filter(!is.na(lab_id))  #filtering NAs

write.csv(data_all, "Master_files\\juv_growth_all_data.csv", row.names=FALSE)  #creating/printing csv file of all raw data merged together
```
#This code chunk with specify to R the order in which you want month presented. When not using a data and grouping by month, the default is to put in alphabetical order, this chuck will correct that. 
```{r}
neworder <- c("June","July")
data_all <- arrange(transform(data_all,
             Month=factor(Month,levels=neworder)),Month)
```


```{r}
# Summary of all data

st_height <- summarySE(data_all%>% filter(!is.na(Shell_Height)), measurevar="Shell_Height", groupvars=c("Site", "Month"))

st_height 


```

```{r}
ggplot(data=data_all, aes(x=Site, y=Shell_Height, fill=Site)) +
  geom_boxplot()+  #scale_fill_manual(values=c("forestgreen","orange", "purple"))+
  theme_bw() +  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+ 
  #theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
  labs(title="Mean Shell Height ", x ="Site", y = "Mean Shell Height (mm)") +
  facet_wrap(~Month)
```
Based on the graph above, it looks like we have greater shell growth at FENCE, so 


```{r}

```


```{r}
ggplot(data=data_all, aes(x=Shell_Height)) +
  geom_histogram()+  #scale_fill_manual(values=c("forestgreen","orange", "purple"))+
  theme_bw() +  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+ 
  #theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
  labs(title="Juvenile Shell Height", x ="Height (mm)")+ scale_x_continuous(limits= c(0,80), breaks = seq(0,80, by =5) )+
  scale_y_continuous(limits = c(0,70), breaks = seq(0,70, by = 5))+
 facet_wrap(~ Site + Month, scales = "free", ncol = 1)
# add date to facet wrap after July collection
```


# Read in a summary file for counts and growth rate. Normally we would build code that does this for us, but to ensure you have plots to work with for your presenations, we will use this work around. 

```{r}
df<-read.csv("Side_projects/Juvenile_growth/summary_count_data.csv", header = T)
#$Survival=as.numeric(df$Survival)
```
```{r}
df2 <- df%>%na.omit(Survival)
df2

survival_sum <- summarySE(df2, "Survival", groupvars=c("Site"))
survival_sum
```

```{r}
prop.survived <- ggplot(data=survival_sum, aes(x=Site, y=Survival, fill=Site)) +
  geom_col(color = "black", linewidth =  0.75) +
  geom_bar(stat="identity")+ geom_errorbar(aes(ymin=Survival-se, ymax=Survival+se), width=.2, position=position_dodge(.9))+ #scale_fill_manual(values=c("forestgreen","orange", "purple"))+
  theme_bw() +  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+ scale_fill_manual(values = c("orange1", "cornflowerblue") )+
  #theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
  labs(x ="Site", y = "Propotion Survived") +
# could add a facet_wrap for date
  theme(axis.title = element_text(size = rel(1.7)), axis.text = element_text(size = rel(1.3)), plot.margin = margin(10, 150, 10, 150), legend.text = element_text(size = 13), legend.title = element_text(size = 19))+
  ylim(0,1)
prop.survived
```
```{r}
pdf(paste0(path = "Side_projects/Juvenile_growth/outputs/" ,"NEWprop_survived2024.pdf"), height = 7, width = 11)
print(prop.survived)
dev.off()
```


```{r}
growth.rate <- ggplot(data=df, aes(x=Site, y=GR_mergedT0, fill=Site)) +
  geom_boxplot(width = 2)+  #scale_fill_manual(values=c("forestgreen","orange", "purple"))+
  theme_bw() +  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+scale_fill_manual(values = c("orange1", "cornflowerblue") )+
  #theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
  labs(x ="Site", y = "Growth Rate (mm / month)") +
# could add a facet_wrap for date
  theme(axis.title = element_text(size = rel(1.7)), axis.text = element_text(size = rel(1.3)), plot.margin = margin(10, 150, 10, 150))+
  ylim(0,16)
  

growth.rate
```

# use to save indivdual graphs as a pdf in the outputs folder. must make graph an object first
```{r}
pdf(paste0(path = "Side_projects/Juvenile_growth/outputs/" ,"NEWgrowthrate2024.pdf"), height = 7, width = 11)
print(growth.rate)
dev.off()
```


Testing assumptions for statistical analysis (Survival and Growth rate)

  #### Code not working - resume edits here (km, 7/14/2024).
```{r}
library(rstatix)

leveneTest(Survival ~ Site, data=df
shapiro.test(df$Survival)

leveneTest(Growth_rate ~ Site, data=df
shapiro.test(df$Growth_rate)
```


```{r}
sessionInfo()
```


